{"version":3,"file":"injected.js","mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://rapid-devtools/./src/injected/injected.js"],"sourcesContent":["console.log(\"DevTools script injected\")\n\n//SEND HISTORY TO CONTENT SCRIPT > SERVICE WORKER > DEVTOOLS\nlet rapidVersion = window.rapidContext.version;\nlet rapidHistory = window.rapidContext.systems.editor.history;\nlet currHistIndex = 0;\nlet diffObj = []\n\n/*\nExample of diffObj properties.\n\ndiffObj = [\n  1: {\n      annotation: 'Deleted an area'\n      didChange: {'deletion'}\n      changes: {}\n    }\n]\n*/\n\n//Test area: http://127.0.0.1:8080/#map=19.58/37.29942/-121.76374&background=Bing&datasets=fbRoads,msBuildings&disable_features=boundaries\n\nconst updateDifferences = () => {\n  diffObj = [];\n  diffObj.push(new diffEl());\n\n  for (let i = 1; i < rapidHistory.length; i++) {\n    let curr = rapidHistory[i].graph;\n    let prev = rapidHistory[i-1].graph;\n\n    let differences = new Rapid.Difference(prev,curr);\n\n    diffObj.push(new diffEl(\n      rapidHistory[i].annotation,\n      differences.didChange,\n      differences.changes ? Object.fromEntries(differences.changes) : {}\n    ))\n  }\n\n  sendRapidContext();\n}\n\nclass diffEl {\n  constructor (annotation, didChange, changes) {\n    this.annotation = annotation ? annotation : \"No change made.\";\n    this.didChange = didChange ? didChange : \"None.\";\n    this.changes = changes ? changes : \"\";\n  }\n}\n\nconst historyUpdate = () => {\n  rapidHistory = window.rapidContext.systems.editor.history.slice();\n  currHistIndex = window.rapidContext.systems.editor.index;\n  updateDifferences();\n}\n\nconst sendRapidContext = () => {\n  window.postMessage({rapid: {\n    rapidVersion,\n    currHistIndex,\n    diffObj\n  }}, '*');\n}\n\nsendRapidContext();\n\n//Hook into event emitter to send messages whenever there is a change in Rapid's history\nconst editor = window.rapidContext.systems.editor;\n\neditor\n.on('merge', () => {\n  historyUpdate();\n})\n.on('stagingchange', () => {\n  historyUpdate()\n})\n.on('historyjump', () => {\n  historyUpdate()\n});"],"names":[],"sourceRoot":""}